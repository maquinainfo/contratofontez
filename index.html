import React, { useState, useRef } from 'react';
import { Printer, Copy, FileText, Check, Calendar, MapPin, User, DollarSign } from 'lucide-react';

const App = () => {
  // --- DADOS DOS PACOTES (Extraídos do PDF) ---
  const packages = {
    civil: {
      name: "Pacote Fontez Civil",
      price: 970.00,
      installments: 3,
      items: [
        "Fotos no cartório e mini-sessão pós cerimônia",
        "1 fotógrafo",
        "50 fotos digitais entregues via Google Drive",
        "Fotos editadas (corte, cor e luz)",
        "Cobertura fotográfica de até 1 hora"
      ]
    },
    elopement: {
      name: "Pacote Elopement Wedding",
      price: 1670.00,
      installments: 3,
      items: [
        "Cobertura do casamento (Cerimônia e sessão pós-cerimônia)",
        "1 fotógrafo",
        "100 fotos digitais entregues via Google Drive",
        "Fotos editadas (corte, cor e luz)",
        "Cobertura fotográfica de até 2 horas"
      ]
    },
    intimista: {
      name: "Pacote Fontez Intimista (Até 50 convidados)",
      price: 2700.00,
      installments: 5,
      items: [
        "Cobertura do casamento (Cerimônia e Recepção)",
        "1 fotógrafo e 1 assistente de iluminação",
        "200 fotos digitais entregues via Pendrive (Pencard)",
        "Fotos editadas (corte, cor e luz)",
        "Cobertura fotográfica de até 4 horas"
      ]
    },
    memorias: {
      name: "Pacote Fontez Memórias (Até 100 convidados)",
      price: 4700.00,
      installments: 5,
      items: [
        "Cobertura do casamento (Making of, Cerimônia, Recepção e Festa)",
        "2 fotógrafos",
        "400 fotos digitais entregues via Pendrive (Pencard)",
        "Fotos editadas (corte, cor e luz)",
        "Cobertura fotográfica sem limite de tempo",
        "Sessão Pré-wedding (2 horas, 50 fotos via Drive)",
        "100 fotos reveladas 10x15cm"
      ]
    },
    luxo: {
      name: "Pacote Fontez Luxo",
      price: 7700.00,
      installments: 10,
      items: [
        "Cobertura completa (Making of dos noivos até a festa)",
        "2 fotógrafos e 1 assistente de iluminação",
        "600 fotos digitais entregues via Pendrive (Pencard)",
        "Fotos editadas (corte, cor e luz)",
        "Cobertura fotográfica sem limite de tempo",
        "Sessão Pré-wedding (2 horas, 100 fotos via Drive)",
        "1 vídeo reels com imagens de drone",
        "1 álbum encadernado 30x60cm (aberto), capa Corino/Linho, caixa inclusa"
      ]
    }
  };

  // --- ESTADO DO FORMULÁRIO ---
  const [formData, setFormData] = useState({
    clientName: '',
    clientCpf: '',
    clientRg: '',
    clientPhone: '',
    clientEmail: '',
    eventDate: '',
    eventTime: '',
    eventLocation: '',
    selectedPackage: 'memorias',
    contractDate: new Date().toISOString().split('T')[0], // Hoje
    paymentMethod: 'Cartão de Crédito',
    customPrice: '' // Caso queira sobrescrever o preço
  });

  // --- UTILITÁRIOS ---
  const formatCurrency = (value) => {
    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
  };

  const formatDate = (dateString) => {
    if (!dateString) return '___/___/_____';
    const date = new Date(dateString);
    // Ajuste de fuso horário simples para evitar dia anterior
    const userTimezoneOffset = date.getTimezoneOffset() * 60000;
    const adjustedDate = new Date(date.getTime() + userTimezoneOffset);
    return new Intl.DateTimeFormat('pt-BR').format(adjustedDate);
  };

  const formatDateExtenso = (dateString) => {
    if (!dateString) return '___ de ____________ de _____';
    const date = new Date(dateString);
    const userTimezoneOffset = date.getTimezoneOffset() * 60000;
    const adjustedDate = new Date(date.getTime() + userTimezoneOffset);
    return new Intl.DateTimeFormat('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' }).format(adjustedDate);
  };

  const formatExtensoMoney = (value) => {
    // Função simplificada para exibição. Para valores complexos, recomenda-se preencher manualmente ou usar biblioteca externa.
    // Aqui faremos apenas a exibição numérica formatada no texto para segurança.
    return formatCurrency(value);
  };

  // --- AÇÕES ---
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handlePrint = () => {
    window.print();
  };

  const handleCopyText = () => {
    const contractText = document.getElementById('contract-content').innerText;
    navigator.clipboard.writeText(contractText);
    alert("Contrato copiado para a área de transferência!");
  };

  const currentPkg = packages[formData.selectedPackage];
  const finalPrice = formData.customPrice ? parseFloat(formData.customPrice) : currentPkg.price;

  return (
    <div className="min-h-screen bg-gray-100 flex flex-col font-sans text-gray-800">
      
      {/* HEADER - NÃO IMPRESSO */}
      <header className="bg-gray-900 text-white p-4 shadow-md print:hidden">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div className="flex items-center gap-2">
            <FileText className="h-6 w-6 text-yellow-500" />
            <h1 className="text-xl font-bold tracking-wider">FONTEZ <span className="font-light">GERADOR DE CONTRATO</span></h1>
          </div>
          <div className="flex gap-3">
             <button 
              onClick={handleCopyText}
              className="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
            >
              <Copy size={16} /> Copiar Texto
            </button>
            <button 
              onClick={handlePrint}
              className="flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white font-semibold rounded text-sm transition-colors"
            >
              <Printer size={16} /> Imprimir / PDF
            </button>
          </div>
        </div>
      </header>

      <div className="flex flex-col md:flex-row flex-1 max-w-7xl mx-auto w-full p-4 gap-6">
        
        {/* COLUNA ESQUERDA: FORMULÁRIO (NÃO IMPRESSO) */}
        <aside className="w-full md:w-1/3 bg-white p-6 rounded-lg shadow-lg print:hidden h-fit">
          <h2 className="text-lg font-bold mb-4 border-b pb-2 flex items-center gap-2">
            <User size={18} /> Dados do Cliente & Evento
          </h2>
          
          <div className="space-y-4">
            {/* Seleção de Pacote */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Pacote Selecionado</label>
              <select 
                name="selectedPackage" 
                value={formData.selectedPackage} 
                onChange={handleInputChange}
                className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-yellow-500 outline-none bg-yellow-50"
              >
                <option value="civil">Fontez Civil (R$ 970)</option>
                <option value="elopement">Elopement Wedding (R$ 1.670)</option>
                <option value="intimista">Fontez Intimista (R$ 2.700)</option>
                <option value="memorias">Fontez Memórias (R$ 4.700)</option>
                <option value="luxo">Fontez Luxo (R$ 7.700)</option>
              </select>
            </div>

            {/* Dados Pessoais */}
            <div className="grid grid-cols-1 gap-3">
              <input type="text" name="clientName" placeholder="Nome Completo do Cliente" value={formData.clientName} onChange={handleInputChange} className="w-full p-2 border rounded" />
              <div className="grid grid-cols-2 gap-2">
                <input type="text" name="clientCpf" placeholder="CPF" value={formData.clientCpf} onChange={handleInputChange} className="w-full p-2 border rounded" />
                <input type="text" name="clientRg" placeholder="RG" value={formData.clientRg} onChange={handleInputChange} className="w-full p-2 border rounded" />
              </div>
              <div className="grid grid-cols-2 gap-2">
                <input type="text" name="clientPhone" placeholder="Telefone/WhatsApp" value={formData.clientPhone} onChange={handleInputChange} className="w-full p-2 border rounded" />
                <input type="email" name="clientEmail" placeholder="E-mail" value={formData.clientEmail} onChange={handleInputChange} className="w-full p-2 border rounded" />
              </div>
            </div>

            <h2 className="text-lg font-bold mt-6 mb-2 border-b pb-2 flex items-center gap-2">
              <Calendar size={18} /> Detalhes do Evento
            </h2>

            <div className="space-y-3">
              <div className="grid grid-cols-2 gap-2">
                <div>
                  <label className="text-xs text-gray-500">Data do Evento</label>
                  <input type="date" name="eventDate" value={formData.eventDate} onChange={handleInputChange} className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="text-xs text-gray-500">Horário</label>
                  <input type="time" name="eventTime" value={formData.eventTime} onChange={handleInputChange} className="w-full p-2 border rounded" />
                </div>
              </div>
              <input type="text" name="eventLocation" placeholder="Local do Evento (Cidade/Espaço)" value={formData.eventLocation} onChange={handleInputChange} className="w-full p-2 border rounded" />
            </div>

            <h2 className="text-lg font-bold mt-6 mb-2 border-b pb-2 flex items-center gap-2">
              <DollarSign size={18} /> Ajustes Finais
            </h2>
            <div className="grid grid-cols-2 gap-2">
                <div>
                  <label className="text-xs text-gray-500">Data do Contrato</label>
                  <input type="date" name="contractDate" value={formData.contractDate} onChange={handleInputChange} className="w-full p-2 border rounded" />
                </div>
                <div>
                  <label className="text-xs text-gray-500">Valor (Opcional se diferente)</label>
                   <input type="number" name="customPrice" placeholder={currentPkg.price} value={formData.customPrice} onChange={handleInputChange} className="w-full p-2 border rounded" />
                </div>
            </div>

          </div>
          
          <div className="mt-6 bg-blue-50 p-3 rounded text-sm text-blue-800">
            <p><strong>Dica:</strong> Preencha os campos aqui e o contrato ao lado será atualizado instantaneamente.</p>
          </div>
        </aside>

        {/* COLUNA DIREITA: PREVIEW DO CONTRATO (IMPRESSO) */}
        <main className="w-full md:w-2/3 bg-white shadow-2xl print:shadow-none print:w-full print:absolute print:top-0 print:left-0">
          <div id="contract-content" className="p-12 print:p-0 text-justify leading-relaxed text-sm md:text-base font-serif text-black max-w-[21cm] mx-auto min-h-[29.7cm]">
            
            {/* TÍTULO */}
            <div className="text-center mb-8">
              <h1 className="text-xl font-bold uppercase border-b-2 border-black inline-block pb-1 mb-2">Contrato de Produção Fotográfica</h1>
            </div>

            {/* CABEÇALHO */}
            <p className="mb-6">
              <strong>EVENTO:</strong> Casamento em {formatDate(formData.eventDate)}
            </p>

            <p className="mb-6">
              Pelo presente instrumento particular de contrato de prestação de serviços fotográficos, de um lado, denominada <strong>CONTRATANTE:</strong> {formData.clientName || "________________________"}, CPF: {formData.clientCpf || "___________"}, RG: {formData.clientRg || "___________"}, telefone {formData.clientPhone || "___________"}, e-mail: {formData.clientEmail || "___________"}, 
              de outro lado denominado <strong>CONTRATADO:</strong> Eduardo Hercílio Fontes - Fontez Fotografia, residente e domiciliado na Rua Três de Outubro nº 61, Imbituba, CNPJ 47.570.013/0001-60 têm justo e acordado o que consta das cláusulas e condições seguintes referentes a prestação de serviço de cobertura fotográfica.
            </p>

            {/* DADOS DO EVENTO */}
            <div className="mb-6 border p-4 border-black">
              <p className="font-bold mb-2 uppercase text-center">Dados do Evento</p>
              <p><strong>Data:</strong> {formatDate(formData.eventDate)}</p>
              <p><strong>Horário:</strong> {formData.eventTime || "__:__"}</p>
              <p><strong>Local:</strong> {formData.eventLocation || "________________________"}</p>
            </div>

            {/* CLÁUSULA 1 */}
            <div className="mb-6">
              <h3 className="font-bold underline mb-2">Cláusula 1º.: DO SERVIÇO</h3>
              <p className="mb-2">O valor deste contrato se refere a realização dos seguintes serviços:</p>
              
              <div className="pl-4 mb-2">
                <strong className="block uppercase mb-1">{currentPkg.name}</strong>
                <ul className="list-disc pl-5 space-y-1">
                  {currentPkg.items.map((item, index) => (
                    <li key={index}>{item}</li>
                  ))}
                </ul>
              </div>
              
              <p className="italic text-xs mt-2">
                * Prévia de 20 fotos em até 07 dias úteis, com entrega final em até {formData.selectedPackage === 'civil' ? '20' : '45'} dias úteis.
              </p>
            </div>

            {/* CLÁUSULA 2 */}
            <div className="mb-6">
              <h3 className="font-bold underline mb-2">Cláusula 2º.: DO PREÇO, CONDIÇÕES DE PAGAMENTO e PRODUTO</h3>
              
              <p className="mb-2">
                <strong>2.1 -</strong> O valor total dos serviços/produtos é de <strong>{formatCurrency(finalPrice)}</strong>, a ser pago por meio de link de pagamento, no cartão de crédito, em até {currentPkg.installments} (dez) parcelas sem juros, ou com 5% de desconto à vista via Pix na reserva da data.
              </p>
              
              <p className="mb-2"><strong>2.2 -</strong> A data fica reservada mediante ao pagamento.</p>
              
              <p className="mb-2"><strong>2.3 -</strong> As fotos sofrerão pequenas correções quando necessário, como por exemplo, correções leves na face. Alterações grandes não serão realizadas, por exemplo, tirar uma pessoa da foto, ou manipular a cena retirando ou colocando novos itens. Caso isso seja solicitado, será cobrado separadamente;</p>
              
              <p className="mb-2"><strong>2.4 -</strong> O CONTRATADO se resguarda o direito de expor sua marca nos produtos ora contratados.</p>
              
              <p className="mb-2"><strong>2.5 -</strong> Fotos adicionais ao pacote serão cobradas a importância de R$9,50 por foto.</p>
              
              <p className="mb-2"><strong>2.6 -</strong> A CONTRATANTE, autoriza, desde já, a publicação das fotos objeto do presente contrato no endereço eletrônico do CONTRATADO, bem como a presença de fotógrafo(s) assistente(s) que ocasionalmente venha a acompanhá-lo, podendo as fotos serem utilizadas em material publicitário pessoal, participação em concursos e edição de livros, uso dessas imagens em jornais e revistas sem a prévia autorização da CONTRATANTE.</p>
              
              <p className="mb-2"><strong>2.7 -</strong> Caso haja falta de segurança para a equipe ou qualquer tipo de violência, o serviço será interrompido, não cabendo, nesse caso, qualquer pedido de indenização por ambas as partes;</p>
            </div>

            {/* CLÁUSULA 3 */}
            <div className="mb-6">
              <h3 className="font-bold underline mb-2">Cláusula 3ª – DA DESISTÊNCIA E RESERVA DE DATA</h3>
              <p className="mb-2"><strong>3.1</strong> As partes reconhecem que a data contratada é exclusiva, ficando o CONTRATADO impedido de aceitar outros eventos na mesma data, caracterizando perda de oportunidade comercial.</p>
              <p className="mb-2"><strong>3.2</strong> Em caso de desistência por parte da CONTRATANTE, os valores pagos até o momento da desistência poderão ser retidos parcialmente, a título de reserva de data, custos administrativos e perda de agenda, não sendo considerados pagamento antecipado pelos serviços.</p>
              <p className="mb-2"><strong>3.3</strong> O percentual retido será de 40% (quarenta por cento) do valor total do contrato. O saldo eventualmente pago além desse percentual será devolvido em parcelas no prazo de 180 dias úteis.</p>
              <p className="mb-2"><strong>3.4</strong> Alternativamente, a CONTRATANTE poderá optar pelo reagendamento, sujeito à disponibilidade de agenda do CONTRATADO, mantendo-se o valor já pago como crédito.</p>
              <p className="mb-2"><strong>3.5</strong> Em caso de desistência por parte do CONTRATADO, os valores pagos serão devolvidos integralmente, no prazo máximo de 30 dias úteis.</p>
            </div>

            {/* CLÁUSULA 4 */}
            <div className="mb-6">
              <h3 className="font-bold underline mb-2">Cláusula 4º.: DIVERSOS</h3>
              <p className="mb-2"><strong>4.0 -</strong> O CONTRATADO não se responsabiliza por fotos que porventura não sejam realizadas devido à falta de tempo hábil ou por falta de pedido no dia do evento por parte da CONTRATANTE, ou até mesmo por fotos que venham a ser prejudicadas em função de outros profissionais, como: cinegrafistas, cerimonial, celebrante, etc.</p>
              <p className="mb-2"><strong>4.1 -</strong> Fica aqui acordado a exclusividade na cobertura fotográfica do evento, vedando assim outros fotógrafos, que poderiam aparecer no raio de composição de nossa equipe fotográfica gerando a perda de registros únicos.</p>
              <p className="mb-2"><strong>4.2 -</strong> A alimentação e um lugar adequado para a equipe será fornecida pelo contratante.</p>
              <p className="mb-2"><strong>4.3 -</strong> As fotos serão armazenadas em servidores de backup do CONTRATADO por um período de 1 ano e para solicitação de uma 2ª via da mídia com todas as fotos em alta resolução será cobrado o valor de 30% do valor total mencionado neste contrato.</p>
              <p className="mb-2"><strong>4.4 -</strong> Este contrato tem a validade de 12 meses após a data do evento e após esse período o CONTRATADO não terá mais nenhuma responsabilidade para com a CONTRATANTE. Para os contratos com álbum, a sua confecção solicitada após 12 meses da data do evento incorrerá em um reajuste de 30% do valor total descrito neste contrato.</p>
            </div>

            {/* CLÁUSULA 5 */}
            <div className="mb-8">
              <h3 className="font-bold underline mb-2">Cláusula 5º. DO FORO</h3>
              <p>Elegem as partes o foro da comarca da capital de Santa Catarina, com exclusão de qualquer outro, por mais privilegiado que seja, para dirimir eventuais litígios porventura oriundos do presente contrato.</p>
            </div>

            <p className="mb-12">
              E, por acharem em perfeito acordo, em tudo quanto neste instrumento particular foi lavrado, obrigam-se a cumprir o presente contrato, assinando-o em duas vias de igual teor.
            </p>

            {/* ASSINATURAS */}
            <div className="mt-8">
              <p className="text-right mb-12">Imbituba, {formatDateExtenso(formData.contractDate)}</p>

              <div className="grid grid-cols-2 gap-12 mt-16">
                <div className="text-center">
                  <div className="border-t border-black pt-2 w-4/5 mx-auto"></div>
                  <p className="font-bold">Eduardo Hercílio Fontes</p>
                  <p className="text-sm">CPF: 048.067.959-25</p>
                  <p className="font-bold mt-1">CONTRATADO</p>
                </div>

                <div className="text-center">
                  <div className="border-t border-black pt-2 w-4/5 mx-auto"></div>
                  <p className="font-bold">{formData.clientName || "CONTRATANTE"}</p>
                  <p className="text-sm">CPF: {formData.clientCpf || "___________"}</p>
                  <p className="font-bold mt-1">CONTRATANTE</p>
                </div>
              </div>
            </div>

          </div>
        </main>
      </div>

      <style>{`
        @media print {
          @page { margin: 1cm; size: A4; }
          body { background: white; }
          header, aside { display: none !important; }
          main { width: 100% !important; box-shadow: none !important; margin: 0 !important; padding: 0 !important; }
          #contract-content { padding: 0 !important; font-size: 11pt; line-height: 1.3; }
        }
      `}</style>
    </div>
  );
};

export default App;
